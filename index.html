<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Universal Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top,#1b2145,#070912 70%);
  color:#fff;
  font-family:Inter,system-ui,sans-serif;
}

/* HOME */
#home{
  padding:22px;
  max-width:1200px;
  margin:auto;
}
h2{
  margin:0 0 14px;
  font-weight:700;
}
.controls{
  display:grid;
  grid-template-columns:140px 1fr;
  gap:10px;
}
input,select,button{
  padding:13px;
  border-radius:10px;
  border:none;
  font-size:15px;
}
input,select{
  background:#0f1430;
  color:#fff;
}
input::placeholder{color:#aaa}
button{
  background:linear-gradient(135deg,#6a5cff,#8f7bff);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}

/* TV EXTRA */
#tvFields{
  margin-top:10px;
  display:none;
  gap:10px;
}
#tvFields input{
  width:100%;
  margin-top:8px;
}

/* RESULTS */
#results{
  margin-top:24px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:18px;
}
.card{
  background:#0e132e;
  border-radius:14px;
  overflow:hidden;
  cursor:pointer;
  transition:.25s;
}
.card:hover{
  transform:translateY(-5px);
}
.card img{
  width:100%;
  aspect-ratio:2/3;
  object-fit:cover;
}
.card .info{
  padding:10px;
}
.card h4{
  margin:0;
  font-size:14px;
  font-weight:600;
}
.card span{
  font-size:12px;
  color:#aaa;
}

/* PLAYER */
#playerBox{
  display:none;
  width:100%;
  height:100vh;
}
iframe{
  width:100%;
  height:100%;
  border:none;
  background:#000;
}
</style>
</head>

<body>

<!-- HOME -->
<div id="home">
  <h2>Movie / TV Player</h2>

  <div class="controls">
    <select id="type">
      <option value="movie">Movie</option>
      <option value="tv">TV Show</option>
    </select>
    <input id="query" placeholder="Search movie or TV show name">
  </div>

  <div id="tvFields">
    <input id="season" placeholder="Season number">
    <input id="episode" placeholder="Episode number">
  </div>

  <button id="playBtn" style="margin-top:14px">Search</button>

  <div id="results"></div>
</div>

<!-- PLAYER -->
<div id="playerBox">
  <iframe
    id="player"
    allowfullscreen
    allow="autoplay; fullscreen; encrypted-media"
    sandbox="allow-scripts allow-same-origin allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox">
  </iframe>
</div>

<script>
/* CONFIG */
const TMDB_KEY = "c88113b226b2687a8bd933ae8cac61f4";
const BASE_URL = "https://bunnyddl.termsandconditionshere.workers.dev";
const IMG = "https://image.tmdb.org/t/p/w500";

/* ELEMENTS */
const home = document.getElementById("home");
const playerBox = document.getElementById("playerBox");
const iframe = document.getElementById("player");
const typeEl = document.getElementById("type");
const queryEl = document.getElementById("query");
const seasonEl = document.getElementById("season");
const episodeEl = document.getElementById("episode");
const results = document.getElementById("results");

/* UI TOGGLE */
typeEl.addEventListener("change",()=>{
  document.getElementById("tvFields").style.display =
    typeEl.value === "tv" ? "block" : "none";
});

/* UNIQUE CODE */
function makeCode(){
  return Math.random().toString(36).slice(2,10);
}

/* SEARCH */
document.getElementById("playBtn").onclick = async ()=>{
  const type = typeEl.value;
  const name = queryEl.value.trim();
  if(!name) return alert("Enter name");

  results.innerHTML = "";

  const searchURL =
    `https://api.themoviedb.org/3/search/${type}?api_key=${TMDB_KEY}&query=${encodeURIComponent(name)}`;

  const data = await fetch(searchURL).then(r=>r.json());
  if(!data.results || !data.results.length){
    results.innerHTML = "<p>No result found</p>";
    return;
  }

  data.results.slice(0,12).forEach(item=>{
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${item.poster_path ? IMG+item.poster_path : ""}">
      <div class="info">
        <h4>${item.title || item.name}</h4>
        <span>${(item.release_date || item.first_air_date || "").slice(0,4)}</span>
      </div>
    `;
    card.onclick = ()=>openPlayer(item.id);
    results.appendChild(card);
  });
};

/* OPEN PLAYER */
function openPlayer(id){
  let path = "";
  if(typeEl.value === "movie"){
    path = `/movie/${id}`;
  }else{
    if(!seasonEl.value || !episodeEl.value){
      alert("Season & Episode required");
      return;
    }
    path = `/tv/${id}/${seasonEl.value}/${episodeEl.value}`;
  }

  home.style.display = "none";
  playerBox.style.display = "block";

  history.pushState({page:"player"},"",`?watch=${makeCode()}`);

  iframe.src = BASE_URL + path;
}

/* BACK */
window.addEventListener("popstate",()=>{
  iframe.src = "";
  playerBox.style.display = "none";
  home.style.display = "block";
});
</script>

</body>
</html>
